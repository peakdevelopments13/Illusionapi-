<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Illusion Radio Live Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { font-family:'Segoe UI',sans-serif; background:#0f1115; color:#fff; margin:0; padding:20px; display:flex; justify-content:center; }
.container { max-width:1400px; width:100%; }
h2 { color:#00ffc8; text-align:center; margin-bottom:25px; font-weight:700; font-size:2rem; text-shadow:0 0 15px #00ffc8; }
.stats-cards { display:flex; flex-wrap:wrap; justify-content:center; gap:15px; margin-bottom:30px; }
.stat-card { background:#1e1e2f; border-radius:18px; padding:20px 30px; min-width:150px; text-align:center; box-shadow:0 6px 25px rgba(0,255,200,0.25); transition: transform 0.3s, background 0.3s; }
.stat-card:hover { transform:translateY(-6px); background:#00ffc8; color:#0f1115; }
.stat-card h3 { margin:5px 0; font-size:28px; font-weight:700; text-shadow:0 0 6px #00ffc8; }
.stat-card p { margin:0; font-size:15px; color:#a0a0a0; }
.chart-wrapper { width:100%; height:60vh; margin:auto; border-radius:20px; overflow:hidden; background:#1e1e2f; box-shadow:0 8px 30px rgba(0,255,200,0.2);}
canvas { width:100% !important; height:100% !important; display:block; }
.info-bar { display:flex; justify-content:space-between; background: rgba(30,30,40,0.5); padding:12px 20px; border-radius:18px; font-size:14px; margin-top:25px; flex-wrap:wrap; gap:12px; box-shadow:0 6px 20px rgba(0,255,200,0.25); }
#nextUpdate.warning { color:#ff4d4d; font-weight:bold; }
.change { font-size:16px; margin-left:6px; font-weight:bold; }
.change.up { color:#00ff99; }
.change.down { color:#ff4d4d; }
@media(max-width:600px){ .stats-cards{flex-direction:column;align-items:center;} }
</style>
</head>
<body>
<div class="container">
<h2>üéß Illusion Radio Live Dashboard</h2>

<div class="stats-cards">
  <div class="stat-card" id="currentCard">üéß<h3>--</h3><p>Current</p></div>
  <div class="stat-card" id="uniqueCard">üë§<h3>--</h3><p>Unique</p></div>
  <div class="stat-card" id="totalCard">üìà<h3>--</h3><p>Total</p></div>
  <div class="stat-card" id="averageCard">üìä<h3>--</h3><p>Average</p></div>
  <div class="stat-card" id="peakCard">üöÄ<h3>--</h3><p>Peak</p></div>
  <div class="stat-card" id="onlineCard">üë•<h3>--</h3><p>Online Viewers</p></div>
</div>

<div class="chart-wrapper">
    <canvas id="listenerChart"></canvas>
</div>

<div class="info-bar">
  <div id="lastUpdated">üïí Last Updated: --</div>
  <div id="nextUpdate">‚è± Next update in: --</div>
  <div id="totalToday">üìÖ Total listeners today: --</div>
</div>
</div>

<script>
const API_URL = "https://radio.peaksolutions.org.uk/api/nowplaying/4";
let lastValues={current:0,unique:0,total:0,average:0,peak:0};
let nextUpdateTime = Date.now() + 300000; // 5 min
const maxPoints = 288; // 24h, 5 min intervals
let liveHistory = Array(maxPoints).fill({time: '', value: 0});

// Create Chart
const ctx = document.getElementById('listenerChart').getContext('2d');
const gradient = ctx.createLinearGradient(0,0,0,400);
gradient.addColorStop(0,'rgba(0,255,200,0.5)');
gradient.addColorStop(1,'rgba(0,255,200,0)');
const chartData = {
    labels: liveHistory.map(p=>p.time),
    datasets:[{
        label:'Live Listeners',
        data: liveHistory.map(p=>p.value),
        borderColor:'#00ffc8',
        backgroundColor:gradient,
        fill:true,
        tension:0.35,
        pointRadius:4,
        pointHoverRadius:6,
        borderWidth:2
    }]
};
const listenerChart = new Chart(ctx,{
    type:'line',
    data:chartData,
    options:{
        responsive:true,
        maintainAspectRatio:false,
        animation:{duration:1000,easing:'easeOutQuad'},
        plugins:{
            legend:{labels:{color:'#fff', font:{size:14}}},
            tooltip:{backgroundColor:'#1e1e2f', titleColor:'#00ffc8', bodyColor:'#fff', mode:'index', intersect:false}
        },
        scales:{
            x:{ticks:{color:'#9ca3af', maxTicksLimit:24}, grid:{color:'rgba(255,255,255,0.05)'}},
            y:{beginAtZero:true, ticks:{color:'#9ca3af'}, grid:{color:'rgba(255,255,255,0.05)'}}
        }
    }
});

// Countdown
function updateCountdown(){
    const now = Date.now();
    const diff = Math.max(nextUpdateTime-now,0);
    const s = Math.ceil(diff/1000);
    const m = Math.floor(s/60);
    const sec = s%60;
    const el = document.getElementById('nextUpdate');
    el.textContent = `‚è± Next update in: ${m}m ${sec}s`;
    el.classList.toggle('warning', diff<=10000);
}
setInterval(updateCountdown,1000);

// Update Cards
function updateCard(id,type,value){
    const el = document.getElementById(id);
    const diff = lastValues[type]? value - lastValues[type]: 0;
    lastValues[type]=value;
    el.querySelector('h3').innerHTML = value + (diff!==0?` <span class="${diff>0?'up':'down'}">${diff>0?'‚¨Ü':'‚¨á'}</span>`:'');
}

// Fetch Stats
async function fetchStats(){
    try{
        const res = await fetch(API_URL);
        const data = await res.json();
        const listeners = data.listeners || {};
        const current = listeners.current || 0;

        updateCard('currentCard','current',current);
        updateCard('uniqueCard','unique',listeners.unique||0);
        updateCard('totalCard','total',listeners.total||0);
        updateCard('averageCard','average',listeners.average||0);
        updateCard('peakCard','peak',listeners.peak||0);
        updateCard('onlineCard','online',current);

        document.getElementById('lastUpdated').textContent = "üïí Last Updated: "+ new Date().toLocaleTimeString();
        document.getElementById('totalToday').textContent = `üìÖ Total listeners today: ${listeners.total||0}`;

        // Add to liveHistory, shift if over maxPoints
        liveHistory.push({time: new Date().toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'}), value: current});
        if(liveHistory.length>maxPoints) liveHistory.shift();

        chartData.labels = liveHistory.map(p=>p.time);
        chartData.datasets[0].data = liveHistory.map(p=>p.value);
        listenerChart.update();

        nextUpdateTime = Date.now() + 300000; // 5 min
    }catch(e){ console.error(e);}
}

// Initial load
fetchStats();
setInterval(fetchStats,300000); // every 5 min
</script>
</body>
</html>
